import {_isKeyword} from './_isKeyword';
import {_createTermDefinition} from './_createTermDefinition';
import {prependBase} from './prependBase';
import {expand} from './expand';
export function _expandIri(activeCtx, value, relativeTo, localCtx, defined) {
      // already expanded
      if (value === null || _isKeyword(value)) {
        return value;
      }

      // ensure value is interpreted as a string
      value = String(value);

      // define term dependency if not defined
      if (localCtx && value in localCtx && defined[value] !== true) {
        _createTermDefinition(activeCtx, localCtx, value, defined);
      }

      relativeTo = relativeTo || {};
      if (relativeTo.vocab) {
        var mapping = activeCtx.mappings[value];

        // value is explicitly ignored with a null mapping
        if (mapping === null) {
          return null;
        }

        if (mapping) {
          // value is a term
          return mapping['@id'];
        }
      }

      // split value into prefix:suffix
      var colon = value.indexOf(':');
      if (colon !== -1) {
        var prefix = value.substr(0, colon);
        var suffix = value.substr(colon + 1);

        // do not expand blank nodes (prefix of '_') or already-absolute
        // IRIs (suffix of '//')
        if (prefix === '_' || suffix.indexOf('//') === 0) {
          return value;
        }

        // prefix dependency not defined, define it
        if (localCtx && prefix in localCtx) {
          _createTermDefinition(activeCtx, localCtx, prefix, defined);
        }

        // use mapping if prefix is defined
        var mapping = activeCtx.mappings[prefix];
        if (mapping) {
          return mapping['@id'] + suffix;
        }

        // already absolute IRI
        return value;
      }

      // prepend vocab
      if (relativeTo.vocab && '@vocab' in activeCtx) {
        return activeCtx['@vocab'] + value;
      }

      // prepend base
      var rval = value;
      if (relativeTo.base) {
        rval = prependBase(activeCtx['@base'], rval);
      }

      return rval;
    }
