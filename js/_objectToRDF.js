import {_isAbsoluteIri} from './_isAbsoluteIri';
import {_isValue} from './_isValue';
import {_isBoolean} from './_isBoolean';
import {_isDouble} from './_isDouble';
import {_isNumber} from './_isNumber';
import {_isObject} from './_isObject';
import {RDF_LANGSTRING} from './RDF_LANGSTRING';
import {RDF} from './RDF';
import {XSD_STRING} from './XSD_STRING';
import {XSD_INTEGER} from './XSD_INTEGER';
import {XSD_DOUBLE} from './XSD_DOUBLE';
import {XSD_BOOLEAN} from './XSD_BOOLEAN';
export const _objectToRDF = function(item) {
  var object = {};

  // convert value object to RDF
  if(_isValue(item)) {
    object.type = 'literal';
    var value = item['@value'];
    var datatype = item['@type'] || null;

    // convert to XSD datatypes as appropriate
    if(_isBoolean(value)) {
      object.value = value.toString();
      object.datatype = datatype || XSD_BOOLEAN;
    } else if(_isDouble(value) || datatype === XSD_DOUBLE) {
      if(!_isDouble(value)) {
        value = parseFloat(value);
      }
      // canonical double representation
      object.value = value.toExponential(15).replace(/(\d)0*e\+?/, '$1E');
      object.datatype = datatype || XSD_DOUBLE;
    } else if(_isNumber(value)) {
      object.value = value.toFixed(0);
      object.datatype = datatype || XSD_INTEGER;
    } else if('@language' in item) {
      object.value = value;
      object.datatype = datatype || RDF_LANGSTRING;
      object.language = item['@language'];
    } else {
      object.value = value;
      object.datatype = datatype || XSD_STRING;
    }
  } else {
    // convert string/node object to RDF
    var id = _isObject(item) ? item['@id'] : item;
    object.type = (id.indexOf('_:') === 0) ? 'blank node' : 'IRI';
    object.value = id;
  }

  // skip relative IRIs
  if(object.type === 'IRI' && !_isAbsoluteIri(object.value)) {
    return null;
  }

  return object;
}
